
<div class="page-shell">
  <div class="container">
    <!-- HEADER -->
    <div class="dashboard-header">
      <div>
        <h2 class="dashboard-title">Customers Dashboard</h2>
        <p class="dashboard-subtitle">Manage and monitor all customer accounts</p>
      </div>
    </div>

    <!-- Customers Cards -->
    <div class="section">
      <div class="section-inner">
        <div class="customers-grid">
          <div *ngIf="customers.length === 0" class="empty-state">
            <div class="empty-state-icon">ðŸ‘¥</div>
            <p>No customers found. Create one to get started.</p>
          </div>

          <div *ngFor="let c of customers" class="customer-card">
            <div class="customer-header">
              <h3 class="customer-name">{{ c.name }}</h3>
              <p class="customer-email">{{ c.email }}</p>
            </div>

            <div class="customer-stats">
              <div class="stat-row">
                <span class="stat-label">Status</span>
                <span class="stat-badge" [ngClass]="c.isActive ? 'active' : 'inactive'">
                  {{ c.isActive ? 'Active' : 'Inactive' }}
                </span>
              </div>

              <div class="stat-row">
                <span class="stat-label">Total Orders</span>
                <span class="stat-value">{{ c.totalOrders }}</span>
              </div>

              <div class="stat-row">
                <span class="stat-label">Latest Order</span>
                <span class="stat-value">
                  {{ c.latestOrderTime ? (c.latestOrderTime | date:'short') : 'â€”' }}
                </span>
              </div>
            </div>

            <button class="view-orders-button" (click)="openOrders(c.id)">
              View Orders â†’
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Create -->
    <div class="section">
      <div class="section-inner">
        <div class="form-section">
          <h2 class="form-title">Create New Customer</h2>

          <div *ngIf="createMsg" class="alert" [class.alert-success]="createMsgType === 'success'" [class.alert-error]="createMsgType === 'error'">
            {{ createMsg }}
          </div>

          <form [formGroup]="createForm" (ngSubmit)="onCreateSubmit()">
            <div class="form-group">
              <label>Customer Name</label>
              <input type="text" formControlName="name" placeholder="John Doe" class="form-input">
              <span *ngIf="createForm.get('name')?.invalid && createForm.get('name')?.touched" class="error-text">
                Name is required (min 2 chars)
              </span>
            </div>

            <div class="form-group">
              <label>Email Address</label>
              <input type="email" formControlName="email" placeholder="john@example.com" class="form-input">
              <span *ngIf="createForm.get('email')?.invalid && createForm.get('email')?.touched" class="error-text">
                Valid email is required
              </span>
            </div>

            <div class="form-group">
              <label>Status</label>
              <select formControlName="isActive" class="form-input">
                <option [value]="true">Active</option>
                <option [value]="false">Inactive</option>
              </select>
            </div>

            <div class="form-actions">
              <button type="submit" [disabled]="createLoading" class="btn btn-primary">
                {{ createLoading ? 'Creating...' : 'Create Customer' }}
              </button>
              <button type="button" (click)="onCreateReset()" class="btn btn-secondary">
                Clear
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!--  Update -->
    <div class="section">
      <div class="section-inner">
        <div class="form-section">
          <h2 class="form-title">Update Customer</h2>

          <div *ngIf="updateMsg" class="alert" [class.alert-success]="updateMsgType === 'success'" [class.alert-error]="updateMsgType === 'error'">
            {{ updateMsg }}
          </div>

          <form [formGroup]="updateForm" (ngSubmit)="onUpdateSubmit()">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Select Customer to Edit</label>
                <select class="form-select" formControlName="customerId" (change)="onCustomerSelect()" required>
                  <option value="">-- Choose a customer --</option>
                  <option *ngFor="let customer of customers" [value]="customer.id">
                    {{ customer.name }} ({{ customer.email }})
                  </option>
                </select>
              </div>
            </div>

            <div *ngIf="updateFieldsVisible" id="updateFields">
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Customer Name</label>
                  <input type="text" class="form-input" formControlName="name" placeholder="John Doe">
                  <span *ngIf="updateForm.get('name')?.invalid && updateForm.get('name')?.touched" class="error-text">
                    Name is required (min 2 chars)
                  </span>
                </div>

                <div class="form-group">
                  <label class="form-label">Email Address</label>
                  <input type="email" class="form-input" formControlName="email" placeholder="john@example.com">
                  <span *ngIf="updateForm.get('email')?.invalid && updateForm.get('email')?.touched" class="error-text">
                    Valid email is required
                  </span>
                </div>

                <div class="form-group">
                  <label class="form-label">Status</label>
                  <select class="form-select" formControlName="isActive">
                    <option [value]="true">Active</option>
                    <option [value]="false">Inactive</option>
                  </select>
                </div>
              </div>

              <div class="form-actions">
                <button type="submit" [disabled]="updateLoading" class="btn btn-primary">
                  {{ updateLoading ? 'Updating...' : 'Update Customer' }}
                </button>
                <button type="button" (click)="onUpdateReset()" class="btn btn-secondary">
                  Cancel
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Quick actions -->
    <div class="section">
      <div class="section-inner">
        <div class="manage-section">
          <h2 class="manage-title">Quick Actions</h2>

          <div *ngIf="customers.length === 0" style="color: var(--gray-600); text-align: center; padding: 28px 0; font-weight: 700;">
            <p>No customers to manage. Create one first!</p>
          </div>

          <div *ngIf="customers.length > 0" class="manage-grid">
            <div *ngFor="let customer of customers" class="manage-item">
              <div class="manage-info">
                <div class="manage-name">{{ customer.name }}</div>
                <div class="manage-email">{{ customer.email }}</div>
              </div>
              <div class="manage-actions">
                <button class="btn-delete-small" (click)="openDeleteModal(customer)">Delete</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- DELETE  MODAL -->
    <div class="modal-overlay" [class.active]="showDeleteModal">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Delete Customer</h4>
        </div>
        <div class="modal-body">
          <p style="color: var(--gray-600); margin: 0;">
            Are you sure you want to delete <strong>{{ customerToDelete?.email }}</strong>? This action cannot be undone.
          </p>
        </div>
        <div class="modal-footer">
          <button class="btn-modal-cancel" (click)="closeDeleteModal()">Cancel</button>
          <button class="btn-modal-submit" [disabled]="deleteLoading" (click)="confirmDelete()">
            {{ deleteLoading ? 'Deleting...' : 'Delete Customer' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
